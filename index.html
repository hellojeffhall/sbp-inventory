<!doctype HTML>
<html>
<head>
  <title>Sample Title</title>
</head>

<body>

  <script src="/socket.io/socket.io.js"></script>
  <script> 
    var socket = io();

    var submit_item = function(){
      var new_name = document.getElementById('item_name_field').value;
      var new_qty = document.getElementById('item_qty_field').value;
      var item_info = {"name" : new_name, "qty" : new_qty};
      socket.emit('request_newItem', item_info);
      document.getElementById('item_name_field').value = "";
      document.getElementById('item_qty_field').value = "";
    };

    var newRow = function(obj){
      var row = document.createElement('tr');

      var nameTd = document.createElement('td');
      nameTd.appendChild(document.createTextNode(obj.name));

      var qtyTd = document.createElement('td');
      qtyTd.appendChild(document.createTextNode(obj.qty));

      row.appendChild(nameTd);
      row.appendChild(qtyTd);
      
      console.log(row);
      return (row);
    };

    socket.on('update_itemsList', function(data){
      // When we have many rows to rewrite, this will suck,
      // but for now it might be OK to clear all rows and rewrite them.

      document.getElementById('list_items').innerHTML = '<tr><th>Item Name</th><th>Quantity</th></tr>';

      for (var i in data){
        document.getElementById('list_items')
                .appendChild(newRow(data[i]));
      }

    });


    socket.on('update_results', function(data){
      alert(data);
      var headings = data.column_headings; // Array of columns to display
                                           // should include "column_name_db" and 
                                           // "column_name_display".

      var rows = data.rows;                // Array of rows to display.
                                           // Each row object should have a "column_name_db"
                                           // property as well as a "value" property.
                                           // This way, we know what to display
                                           // and under which column.
      alert('typeof rows=' + typeof rows);
      var html_to_return = '';

      //alert(headings);
      //alert(rows);

      for(var i in rows){
        var row = rows[i];

        html_to_return += '<tr>';

        for(var i in headings){
          html_to_return += '<td>' + row.headings[i] + '</td>';
        }

        html_to_return += '</tr>';
      }
      alert(html_to_return);
      document.getElementById('list_items').innerHTML = html_to_return;
    });

  </script>

  <table id='list_items'>
  </table>

  <br><br><br>
  <input id="item_name_field" placeholder="Name"></input>
  <input id="item_qty_field" placeholder="Quantity"></input>
  <button onclick="submit_item()">Submit!</button>
</body>

</html>
