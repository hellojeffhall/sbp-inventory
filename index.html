<!doctype HTML>
<html>
<head>
  <title>Sample Title</title>
</head>

<body>

  <script src="/socket.io/socket.io.js"></script>
  <script> 
    var socket = io();

    var submit_item = function(){
      var new_name = document.getElementById('item_name_field').value;
      var new_qty = document.getElementById('item_qty_field').value;
      var item_info = {"name" : new_name, "qty" : new_qty};
      socket.emit('request_newItem', item_info);
      document.getElementById('item_name_field').value = "";
      document.getElementById('item_qty_field').value = "";
    };

    var newRow = function(obj){
      alert('function newRow running');
      var row = document.createElement('tr');

      var nameTd = document.createElement('td');
      nameTd.appendChild(document.createTextNode(obj.name));

      var qtyTd = document.createElement('td');
      qtyTd.appendChild(document.createTextNode(obj.qty));

      row.appendChild(nameTd);
      row.appendChild(qtyTd);
      
      console.log('row: ' + row);
      return (row);
    };

    socket.on('update_results', function(data){
      alert('data.rows according to browser: ' + data.rows);
      alert('data.column_headings, according to browser: ' + data.column_headings);

      var headings = data.column_headings; // Array of columns to display
                                           // should include "column_name_db" and 
                                           // "column_name_display".

      var rows = data.rows;                // Array of rows to display.
                                           // Each row object should have a "column_name_db"
                                           // property as well as a "value" property.
                                           // This way, we know what to display
                                           // and under which column.
     alert('about to do map stuff');
      var html_array = data.rows.map(function(temp_row){
        var this_row = headings.map(function(temp_heading){
          return '<td>' + temp_row[temp_heading] + '</td>';          
        });
        this_row.unshift('<tr>');
        this_row.push('</tr>');
        //alert('stringify this row = ' + JSON.stringify(this_row));
        return this_row.join('');
      });

//
//      for(var i in rows){
//        var row = rows[i];
//
//        html_to_return += '<tr>';
//
//        for(var j in headings){
//          var temp_heading = headings[j];
//          html_to_return += ('<td>' + row[temp_heading] + '</td>');
//        }
//

//      alert('html_array prejoin= ' + html_array    
//        html_array.join("");

      alert('html_array prejoin= ' + html_array);
      document.getElementById('list_items').innerHTML = html_array.join();
    });

  </script>

  <table id='list_items'>
  </table>

  <br><br><br>
  <input id="item_name_field" placeholder="Name"></input>
  <input id="item_qty_field" placeholder="Quantity"></input>
  <button onclick="submit_item()">Submit!</button>
</body>

</html>
